let a=1;const b=3,o={};let g,i,d,l;function E(){if(g=document.getElementById("progressFill"),i=document.getElementById("communicationForm"),d=document.getElementById("successMessage"),l=document.getElementById("submitBtn"),!g||!i||!d||!l){console.error("Required DOM elements not found");return}const n=document.getElementById("message"),e=document.getElementById("charCount");n&&e&&n.addEventListener("input",()=>{const t=n.value.length;e.textContent=`${t} / 1000 caracteres`,t>900?e.style.color=t>990?"#ff4444":"#ffaa33":e.style.color="#666"}),i.addEventListener("submit",x)}function C(){I()&&(document.getElementById(`step${a}`)?.classList.remove("active"),a++,y(),document.getElementById(`step${a}`)?.classList.add("active"),a===3&&T(),v())}function S(){document.getElementById(`step${a}`)?.classList.remove("active"),a--,y(),document.getElementById(`step${a}`)?.classList.add("active"),v()}function y(){const n=(a-1)/(b-1)*100;g.style.width=`${n}%`}function v(){document.querySelectorAll(".step").forEach(e=>{const t=parseInt(e.getAttribute("data-step")||"0");t<a?(e.classList.add("completed"),e.classList.remove("active")):t===a?(e.classList.add("active"),e.classList.remove("completed")):e.classList.remove("active","completed")})}function I(){if(a===1){const n=document.getElementById("name"),e=document.getElementById("email"),t=document.getElementById("topic");if(!n.value.trim())return alert("Por favor ingresa tu nombre completo"),n.focus(),!1;if(!e.value.trim()||!h(e.value))return alert("Por favor ingresa un correo electrónico válido"),e.focus(),!1;if(!t.value)return alert("Por favor selecciona un tema para tu mensaje"),t.focus(),!1;o.name=n.value.trim(),o.email=e.value.trim(),o.topic=t.value}else if(a===2){const n=document.getElementById("messageType"),e=document.getElementById("subject"),t=document.getElementById("message"),s=document.getElementById("urgency"),c=document.getElementById("responsePreference"),r=document.getElementById("privacyAccept");if(!n.value)return alert("Por favor selecciona el tipo de mensaje"),n.focus(),!1;if(!e.value.trim())return alert("Por favor ingresa un asunto para tu mensaje"),e.focus(),!1;if(!t.value.trim()||t.value.trim().length<10)return alert("Por favor escribe un mensaje más detallado (mínimo 10 caracteres)"),t.focus(),!1;if(!s.value)return alert("Por favor indica el nivel de urgencia"),s.focus(),!1;if(!c.value)return alert("Por favor selecciona tu preferencia de respuesta"),c.focus(),!1;if(!r.checked)return alert("Debes aceptar la política de privacidad para continuar"),!1;o.messageType=n.value,o.subject=e.value.trim(),o.message=t.value.trim(),o.urgency=s.value,o.responsePreference=c.value,o.privacyAccept=r.checked}return!0}function h(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}function T(){const n=document.getElementById("confirmName"),e=document.getElementById("confirmEmail"),t=document.getElementById("confirmTopic"),s=document.getElementById("confirmMessageType"),c=document.getElementById("confirmUrgency"),r=document.getElementById("confirmSubject"),m=document.getElementById("confirmMessage");n&&(n.textContent=o.name||""),e&&(e.textContent=o.email||"");const u={economia:"💰 Economía y Empleo",salud:"🏥 Salud Pública",educacion:"🎓 Educación",seguridad:"🛡️ Seguridad",infraestructura:"🏗️ Infraestructura",social:"🤝 Desarrollo Social","medio-ambiente":"🌱 Medio Ambiente",otros:"📋 Otros Temas"};t&&(t.textContent=u[o.topic||"otros"]||"");const f={inquietud:"💭 Inquietud o Preocupación",propuesta:"💡 Propuesta o Sugerencia",felicitacion:"👏 Felicitación o Apoyo",queja:"⚠️ Queja o Denuncia",peticion:"📝 Petición Específica"};s&&(s.textContent=f[o.messageType||"inquietud"]||"");const B={baja:"📋 Baja - Comentario general",media:"⚡ Media - Situación importante",alta:"🚨 Alta - Requiere atención pronta"};c&&(c.textContent=B[o.urgency||"media"]||""),r&&(r.textContent=o.subject||""),m&&(m.textContent=o.message||"")}function x(n){n.preventDefault(),I()&&L()}function L(){l.disabled=!0,l.innerHTML='<span class="spinner"></span> Enviando...',setTimeout(()=>{i.style.display="none",d.style.display="block";const n=`PRES-${Math.floor(1e5+Math.random()*9e5)}`,e=document.getElementById("trackingNumber");e&&(e.textContent=n);const t={baja:"7-10 días hábiles",media:"3-5 días hábiles",alta:"1-2 días hábiles"},s=document.getElementById("responseTime");s&&(s.textContent=t[o.urgency||"media"]||"5-7 días hábiles"),p("messagesReceived",12847,100),p("responsesGiven",8932,100),p("initiativesCreated",156,50)},2e3)}function p(n,e,t){const s=document.getElementById(n);if(!s)return;const c=parseInt(s.textContent||"0"),r=(e-c)/t;let m=c,u=0;const f=setInterval(()=>{m+=r,u++,s.textContent=Math.floor(m).toString(),u>=t&&(s.textContent=e.toString(),clearInterval(f))},10)}function M(){i.style.display="block",d.style.display="none",document.getElementById(`step${a}`)?.classList.remove("active"),a=1,document.getElementById(`step${a}`)?.classList.add("active"),y(),v(),Object.keys(o).forEach(t=>delete o[t]),i.querySelectorAll("input, textarea, select").forEach(t=>{t instanceof HTMLInputElement&&t.type==="checkbox"?t.checked=!1:(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement)&&(t.value="")});const e=document.getElementById("charCount");e&&(e.textContent="0 / 1000 caracteres",e.style.color="#666"),l.disabled=!1,l.innerHTML="📨 Enviar al Presidente",window.scrollTo(0,0)}window.nextStep=C;window.prevStep=S;window.resetForm=M;window.initializeCommunicationForm=E;document.addEventListener("DOMContentLoaded",E);
